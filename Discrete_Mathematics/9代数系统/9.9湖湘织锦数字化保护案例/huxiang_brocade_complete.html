<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹–æ¹˜ç»‡é”¦æ•°å­—åŒ–ä¿æŠ¤ä¸ä¼ æ‰¿ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--glass-border);
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid var(--glass-border);
            border-radius: 8px 8px 0 0;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: rgba(214, 59, 29, 0.1);
            color: var(--accent-red);
        }

        .tab-btn.active {
            background: var(--accent-red);
            color: white;
            border-color: var(--accent-red);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Element Card */
        .element-card {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 15px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid var(--glass-border);
            user-select: none;
        }

        .element-card:active {
            cursor: grabbing;
        }

        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .element-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .element-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .element-type {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .composition-area {
            background: rgba(255, 255, 255, 0.4);
            border: 2px dashed var(--accent-red);
            border-radius: 16px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px;
        }

        .composition-area.has-elements {
            justify-content: flex-start;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .result-display {
            background: linear-gradient(135deg, rgba(214, 59, 29, 0.1), rgba(255, 180, 0, 0.1));
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            min-height: 150px;
        }

        .result-pattern {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .pattern-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .elements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .operation-display {
            font-size: 1.1rem;
            color: var(--accent-red);
            font-weight: 700;
            margin: 10px 0;
        }

        .law-badge {
            display: inline-block;
            padding: 4px 12px;
            background: var(--accent-gold);
            color: var(--text-primary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 4px;
        }

        /* Feature Extraction */
        .brocade-preview {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            background: linear-gradient(135deg, #8b0000, #d63b1d, #ffb400);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .brocade-pattern {
            width: 100%;
            height: 100%;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255, 255, 255, 0.1) 10px, rgba(255, 255, 255, 0.1) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(0, 0, 0, 0.1) 10px, rgba(0, 0, 0, 0.1) 20px);
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-sm);
        }

        .feature-title {
            font-weight: 700;
            color: var(--accent-red);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-palette {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .color-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .texture-preview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .texture-sample {
            aspect-ratio: 1;
            border-radius: 6px;
            box-shadow: var(--shadow-sm);
        }

        .progress-bar {
            height: 8px;
            background: rgba(139, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-red);
            transition: width 0.5s ease;
        }

        .extraction-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-gold);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pattern-elements {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .element-tag {
            padding: 6px 12px;
            background: linear-gradient(135deg, rgba(214, 59, 29, 0.2), rgba(255, 180, 0, 0.2));
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            border: 1px solid var(--accent-red);
        }

        /* Subalgebra Design */
        .subsystem-card {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid var(--glass-border);
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .subsystem-card.selected {
            border-color: var(--accent-red);
            background: rgba(214, 59, 29, 0.1);
            transform: scale(1.02);
            box-shadow: var(--shadow-md);
        }

        .subsystem-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        .subsystem-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-red);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .subsystem-elements {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .mini-element {
            padding: 3px 8px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(214, 59, 29, 0.1));
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-primary);
            border: 1px solid rgba(214, 59, 29, 0.3);
        }

        .design-canvas {
            background: rgba(255, 255, 255, 0.5);
            border: 2px dashed var(--accent-gold);
            border-radius: 16px;
            min-height: 280px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 20px;
        }

        .canvas-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(139, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .canvas-cell.filled {
            animation: fillIn 0.3s ease;
        }

        @keyframes fillIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .operation-rule {
            background: linear-gradient(135deg, rgba(255, 180, 0, 0.1), rgba(214, 59, 29, 0.1));
            padding: 10px;
            border-radius: 8px;
            margin: 6px 0;
            border-left: 3px solid var(--accent-gold);
        }

        .rule-title {
            font-weight: 700;
            color: var(--accent-red);
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .rule-desc {
            font-size: 0.75rem;
            color: var(--text-primary);
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05), rgba(214, 59, 29, 0.05));
            border-left: 4px solid var(--accent-red);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .insight-title {
            font-weight: 700;
            color: var(--accent-red);
            margin-bottom: 8px;
        }

        .innovation-badge {
            display: inline-block;
            padding: 6px 14px;
            background: var(--accent-gold);
            color: var(--text-primary);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin: 4px;
            box-shadow: var(--shadow-sm);
        }

        select.apple-btn {
            appearance: none;
            cursor: pointer;
            padding: 10px 15px;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="window-controls">
                    <span class="dot red"></span>
                    <span class="dot yellow"></span>
                    <span class="dot green"></span>
                </div>
                <h1>æ¹–æ¹˜ç»‡é”¦ <span class="highlight">æ•°å­—ä¼ æ‰¿</span></h1>
                <p class="subtitle">Huxiang Brocade Digital Heritage</p>
            </div>

            <div class="controls-wrapper">
                <div class="control-group">
                    <label>åŠŸèƒ½æ¨¡å—</label>
                    <div class="tab-navigation" style="flex-direction: column; border: none; padding: 0;">
                        <button class="tab-btn active" data-tab="tab1">
                            <span>ğŸ¨</span>
                            <span>å…ƒç´ ä»£æ•°ç³»ç»Ÿ</span>
                        </button>
                        <button class="tab-btn" data-tab="tab2">
                            <span>ğŸ”</span>
                            <span>ç‰¹å¾æå–åˆ†æ</span>
                        </button>
                        <button class="tab-btn" data-tab="tab3">
                            <span>âœ¨</span>
                            <span>å­ç³»ç»Ÿè®¾è®¡</span>
                        </button>
                    </div>
                </div>

                <div id="sidebarContent"></div>

                <div class="control-group">
                    <label>æ–‡åŒ–ä»·å€¼</label>
                    <div class="info-panel">
                        <p style="font-size: 0.85rem;">ä»¥æ•°å­—æŠ€æœ¯å®ˆæŠ¤éé—ï¼Œç”¨åˆ›æ–°æ€ç»´ä¼ æ‰¿å·¥åŒ ç²¾ç¥</p>
                    </div>
                </div>
            </div>

            <div class="actions-footer" id="actionButtons"></div>
        </aside>

        <main class="visualizer-stage">
            <div class="glass-pane" style="padding: 30px; overflow-y: auto;">
                <!-- Tab 1: å…ƒç´ ä»£æ•°ç³»ç»Ÿ -->
                <div class="tab-content active" id="tab1">
                    <h2 style="color: var(--accent-red); margin-bottom: 20px;">ç»„åˆåŒºåŸŸ - æ¢ç´¢å…ƒç´ ç»„åˆçš„æ— é™å¯èƒ½</h2>
                    <div class="composition-area" id="compositionArea">
                        <div style="text-align: center; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ¨</div>
                            <p>æ‹–æ‹½å·¦ä¾§å…ƒç´ åˆ°æ­¤å¤„å¼€å§‹åˆ›ä½œ</p>
                            <p style="font-size: 0.85rem; margin-top: 8px;">ä½“éªŒä¼ ç»Ÿå·¥è‰ºçš„æ•°å­—åŒ–ä¼ æ‰¿</p>
                        </div>
                    </div>
                    <div class="operation-display" id="operationDisplay"></div>
                    <div class="result-display" id="resultDisplay" style="display: none;">
                        <h3 style="color: var(--accent-red); margin-bottom: 10px;">ç”Ÿæˆçš„ç»‡é”¦å›¾æ¡ˆ</h3>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 10px;" id="resultDesc"></p>
                        <div class="result-pattern" id="resultPattern"></div>
                    </div>
                </div>

                <!-- Tab 2: ç‰¹å¾æå– -->
                <div class="tab-content" id="tab2">
                    <h2 style="color: var(--accent-red); margin-bottom: 20px;">ç»‡é”¦æ•°å­—åŒ–å½’æ¡£ä¸ç‰¹å¾åˆ†æ</h2>
                    <div class="brocade-preview" id="brocadePreview">
                        <div class="brocade-pattern" id="brocadePattern"></div>
                    </div>
                    <div id="featuresContainer" style="margin-top: 30px; display: none;">
                        <h3 style="color: var(--text-primary); margin-bottom: 15px;">æå–çš„ç‰¹å¾æ•°æ®</h3>
                        <div class="feature-card" id="colorFeature">
                            <div class="feature-title">
                                <span>ğŸ¨</span>
                                <span>é¢œè‰²ç‰¹å¾åˆ†æ</span>
                            </div>
                            <div class="extraction-status">
                                <div class="status-dot"></div>
                                <span>å·²æå–ä¸»è‰²è°ƒå’Œé…è‰²æ–¹æ¡ˆ</span>
                            </div>
                            <div class="color-palette" id="colorPalette"></div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="feature-card" id="textureFeature">
                            <div class="feature-title">
                                <span>ğŸ§µ</span>
                                <span>çº¹ç†ç‰¹å¾åˆ†æ</span>
                            </div>
                            <div class="extraction-status">
                                <div class="status-dot"></div>
                                <span>å·²è¯†åˆ«ç¼–ç»‡çº¹ç†æ¨¡å¼</span>
                            </div>
                            <div class="texture-preview" id="texturePreview"></div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="feature-card" id="patternFeature">
                            <div class="feature-title">
                                <span>âœ¨</span>
                                <span>å›¾æ¡ˆå…ƒç´ è¯†åˆ«</span>
                            </div>
                            <div class="extraction-status">
                                <div class="status-dot"></div>
                                <span>å·²æå–åŸºæœ¬è®¾è®¡å…ƒç´ </span>
                            </div>
                            <div class="pattern-elements" id="patternElements"></div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="insight-box">
                            <div class="insight-title">ğŸ’¡ å·¥åŒ ç²¾ç¥çš„æ•°å­—ä¼ æ‰¿</div>
                            <p style="font-size: 0.9rem; color: var(--text-primary); line-height: 1.6;">
                                é€šè¿‡ç°ä»£ä¿¡æ¯æŠ€æœ¯å¯¹ä¼ ç»Ÿæ¹–æ¹˜ç»‡é”¦è¿›è¡Œæ•°å­—åŒ–ä¿æŠ¤,æˆ‘ä»¬ä¸ä»…ä¿å­˜äº†çè´µçš„æ–‡åŒ–é—äº§æ•°æ®,
                                æ›´ä¼ æ‰¿äº†æ¹–æ¹˜åœ°åŒºä¸–ä»£åŒ äººçš„ç²¾æ¹›æŠ€è‰ºä¸åˆ›æ–°ç²¾ç¥ã€‚æ¯ä¸€æ¬¡ç‰¹å¾æå–,éƒ½æ˜¯å¯¹ä¼ ç»Ÿå·¥è‰ºçš„å°Šé‡;
                                æ¯ä¸€æ¬¡æ•°æ®å½’æ¡£,éƒ½æ˜¯ä¸ºåäººä¿ç•™æ–‡åŒ–è®°å¿†ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: å­ä»£æ•°ç³»ç»Ÿè®¾è®¡ -->
                <div class="tab-content" id="tab3">
                    <h2 style="color: var(--accent-red); margin-bottom: 20px;">åˆ›æ–°è®¾è®¡ç”»å¸ƒ - ä¼ ç»Ÿä¸ç°ä»£çš„å®Œç¾èåˆ</h2>
                    <div class="design-canvas" id="designCanvas"></div>
                    <div class="insight-box">
                        <div class="insight-title">ğŸ® éé—ä¿æŠ¤ä¸æ•°å­—åŒ–ä¼ æ‰¿</div>
                        <p style="font-size: 0.9rem; color: var(--text-primary); line-height: 1.6;">
                            æ¹–æ¹˜ç»‡é”¦æ‰¿è½½ç€åƒå¹´æ–‡åŒ–è®°å¿†,é€šè¿‡å­ä»£æ•°ç³»ç»Ÿçš„è¯†åˆ«ä¸åº”ç”¨,æˆ‘ä»¬èƒ½å¤Ÿç²¾å‡†æå–ä»£è¡¨æ€§è®¾è®¡å…ƒç´ ,
                            å½¢æˆå¯å¤ç”¨çš„åˆ›æ–°æ¨¡å—ã€‚è¿™ç§æ–¹æ³•ä¸ä»…ä¿æŠ¤äº†ä¼ ç»Ÿå·¥è‰ºçš„æ ¸å¿ƒç‰¹è‰²,æ›´ä¸ºæ–‡åŒ–åˆ›æ–°æä¾›äº†ç§‘å­¦ä¾æ®ã€‚
                        </p>
                        <div style="margin-top: 10px;">
                            <span class="innovation-badge">æ–‡åŒ–è‡ªä¿¡</span>
                            <span class="innovation-badge">å®ˆæ­£åˆ›æ–°</span>
                            <span class="innovation-badge">ç§‘æŠ€èµ‹èƒ½</span>
                            <span class="innovation-badge">åŒ å¿ƒä¼ æ‰¿</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let currentTab = 'tab1';

        // Tab 1 å˜é‡
        const elements = [
            { id: 'E1', name: 'çº¢æ¢…', icon: 'ğŸŒº', type: 'å›¾æ¡ˆ', color: '#d63b1d' },
            { id: 'E2', name: 'é’ç«¹', icon: 'ğŸ‹', type: 'å›¾æ¡ˆ', color: '#2d5016' },
            { id: 'E3', name: 'ç¥¥äº‘', icon: 'â˜ï¸', type: 'å›¾æ¡ˆ', color: '#87ceeb' },
            { id: 'E4', name: 'é‡‘çº¿', icon: 'âœ¨', type: 'çº¹ç†', color: '#ffb400' },
            { id: 'E5', name: 'æœ±ç ‚çº¢', icon: 'ğŸ”´', type: 'é¢œè‰²', color: '#8b0000' },
            { id: 'E6', name: 'å¢¨ç»¿', icon: 'ğŸŸ¢', type: 'é¢œè‰²', color: '#0f3d0f' },
            { id: 'E7', name: 'å‡¤å‡°', icon: 'ğŸ¦…', type: 'å›¾æ¡ˆ', color: '#d4af37' },
            { id: 'E8', name: 'æ³¢çº¹', icon: 'ã€°ï¸', type: 'çº¹ç†', color: '#4682b4' }
        ];
        let composedElements = [];
        let draggedElement = null;

        // Tab 2 å˜é‡
        const samples = {
            sample1: {
                name: 'æ¸…ä»£äº‘é¾™çº¹ç»‡é”¦',
                colors: ['#8b0000', '#d4af37', '#1e3a8a', '#fef3c7'],
                colorNames: ['æœ±ç ‚çº¢', 'èµ¤é‡‘', 'é›è“', 'ç±³é»„'],
                textures: ['æ–œçº¹', 'å¹³çº¹', 'ç¼çº¹', 'æèŠ±'],
                patterns: ['äº‘çº¹', 'é¾™çº¹', 'å¦‚æ„çº¹', 'æ°´æ³¢çº¹', 'ç¥¥äº‘'],
                gradient: 'linear-gradient(135deg, #8b0000, #d4af37, #1e3a8a)'
            },
            sample2: {
                name: 'æ°‘å›½å‡¤å‡°ç‰¡ä¸¹é”¦',
                colors: ['#d63b1d', '#ff69b4', '#228b22', '#ffb400'],
                colorNames: ['æœ±çº¢', 'èƒ­è„‚', 'ç¿ ç»¿', 'æ˜é»„'],
                textures: ['æèŠ±', 'å¹³çº¹', 'æ–œçº¹', 'ç»‡é”¦'],
                patterns: ['å‡¤å‡°', 'ç‰¡ä¸¹', 'å¶è„‰', 'èŠ±è•Š', 'é£ç¾½'],
                gradient: 'linear-gradient(135deg, #d63b1d, #ff69b4, #228b22)'
            },
            sample3: {
                name: 'ä¼ ç»Ÿå‡ ä½•çº¹æ ·é”¦',
                colors: ['#8b4513', '#2f4f4f', '#f5deb3', '#cd853f'],
                colorNames: ['æ£•è¤', 'å¢¨ç»¿', 'æµ…è¤', 'èµ­çŸ³'],
                textures: ['å¹³çº¹', 'æ–œçº¹', 'è±å½¢', 'æ–¹æ ¼'],
                patterns: ['å›çº¹', 'è±å½¢', 'ä¸‡å­—çº¹', 'åçº¹', 'å‡ ä½•'],
                gradient: 'linear-gradient(135deg, #8b4513, #2f4f4f, #f5deb3)'
            },
            sample4: {
                name: 'æ¹˜ç»£é£æ ¼ç»‡é”¦',
                colors: ['#c41e3a', '#006400', '#ffd700', '#4169e1'],
                colorNames: ['ç»¯çº¢', 'æ·±ç»¿', 'é‡‘è‰²', 'å®è“'],
                textures: ['åˆºç»£çº¹', 'ç»£èŠ±', 'ç¼çº¹', 'æèŠ±'],
                patterns: ['èŠ±å‰', 'é£é¸Ÿ', 'å±±æ°´', 'äº‘é›¾', 'ç«¹å¶'],
                gradient: 'linear-gradient(135deg, #c41e3a, #006400, #ffd700)'
            }
        };
        let currentSample = samples.sample1;

        // Tab 3 å˜é‡
        const subsystems = [
            {
                id: 'S1',
                name: 'ä¼ ç»Ÿé¾™å‡¤å‘ˆç¥¥ç³»ç»Ÿ',
                icon: 'ğŸ‰',
                elements: ['é¾™çº¹', 'å‡¤å‡°', 'ç¥¥äº‘', 'æœ±çº¢', 'èµ¤é‡‘'],
                colors: ['#8b0000', '#d4af37', '#ff6b6b', '#ffd700'],
                style: 'å®«å»·é£æ ¼',
                rules: [
                    { title: 'å¯¹ç§°æ€§', desc: 'é¾™å‡¤å…ƒç´ éœ€ä¿æŒå·¦å³å¯¹ç§°' },
                    { title: 'è‰²å½©æ­é…', desc: 'æœ±çº¢ä¸èµ¤é‡‘ä¸ºä¸»è‰²è°ƒ' },
                    { title: 'å›¾æ¡ˆç»„åˆ', desc: 'ç¥¥äº‘ä½œä¸ºèƒŒæ™¯è£…é¥°å…ƒç´ ' }
                ]
            },
            {
                id: 'S2',
                name: 'æ±Ÿå—æ°´ä¹¡ç³»ç»Ÿ',
                icon: 'ğŸŒŠ',
                elements: ['è·èŠ±', 'æŸ³å¶', 'æ³¢çº¹', 'é’ç»¿', 'æ·¡è“'],
                colors: ['#2d5016', '#87ceeb', '#90ee90', '#4682b4'],
                style: 'æ¸…æ–°æ·¡é›…',
                rules: [
                    { title: 'æµåŠ¨æ„Ÿ', desc: 'æ³¢çº¹ä¸æŸ³å¶è¥é€ åŠ¨æ€ç¾' },
                    { title: 'æ¸…æ–°é…è‰²', desc: 'é’ç»¿ä¸æ·¡è“ä¸ºåŸºè°ƒ' },
                    { title: 'è‡ªç„¶èåˆ', desc: 'è·èŠ±ä½œä¸ºè§†è§‰ç„¦ç‚¹' }
                ]
            },
            {
                id: 'S3',
                name: 'æ°‘ä¿—å–œåº†ç³»ç»Ÿ',
                icon: 'ğŸŠ',
                elements: ['ç‰¡ä¸¹', 'è´è¶', 'å¦‚æ„', 'å¤§çº¢', 'æ˜é»„'],
                colors: ['#d63b1d', '#ffb400', '#ff69b4', '#ff8c00'],
                style: 'çƒ­çƒˆå–œåº†',
                rules: [
                    { title: 'é¥±æ»¡æ„å›¾', desc: 'ç‰¡ä¸¹è´è¶å¡«å……ç”»é¢' },
                    { title: 'é²œè‰³å¯¹æ¯”', desc: 'å¤§çº¢æ˜é»„å½¢æˆå¼ºå¯¹æ¯”' },
                    { title: 'å‰ç¥¥å¯“æ„', desc: 'å¦‚æ„çº¹ç‚¹ç¼€å¢æ·»å–œæ°”' }
                ]
            },
            {
                id: 'S4',
                name: 'ç¦…æ„å±±æ°´ç³»ç»Ÿ',
                icon: 'â›°ï¸',
                elements: ['å±±å³°', 'æ¾æ ‘', 'ä»™é¹¤', 'æ°´å¢¨', 'ç•™ç™½'],
                colors: ['#2f4f4f', '#696969', '#d3d3d3', '#f5f5dc'],
                style: 'ç©ºçµæ·¡é›…',
                rules: [
                    { title: 'ç•™ç™½è‰ºæœ¯', desc: 'ä¿ç•™å¤§é‡ç©ºç™½ç©ºé—´' },
                    { title: 'æ°´å¢¨æ¸²æŸ“', desc: 'ä½¿ç”¨æ°´å¢¨è‰²è°ƒæ¸å˜' },
                    { title: 'æ„å¢ƒè¥é€ ', desc: 'å±±æ°´ä»™é¹¤ä¼ è¾¾ç¦…æ„' }
                ]
            }
        ];
        let selectedSubsystem = null;
        let designCells = [];

        // ==================== Tab åˆ‡æ¢ ====================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;
                switchTab(tabId);
            });
        });

        function switchTab(tabId) {
            currentTab = tabId;

            // æ›´æ–°tabæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabId);
            });

            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });

            // æ›´æ–°ä¾§è¾¹æ 
            updateSidebar(tabId);
        }

        function updateSidebar(tabId) {
            const sidebarContent = document.getElementById('sidebarContent');
            const actionButtons = document.getElementById('actionButtons');

            if (tabId === 'tab1') {
                sidebarContent.innerHTML = `
                    <div class="control-group">
                        <label>åŸºç¡€è®¾è®¡å…ƒç´ </label>
                        <div class="elements-grid" id="elementsGrid"></div>
                    </div>
                    <div class="control-group">
                        <label>ä»£æ•°è¿ç®—å¾‹</label>
                        <div class="info-panel">
                            <span class="law-badge">ç»“åˆå¾‹</span>
                            <span class="law-badge">äº¤æ¢å¾‹</span>
                            <span class="law-badge">åˆ†é…å¾‹</span>
                            <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                                æ‹–æ‹½å…ƒç´ åˆ°ç»„åˆåŒºåŸŸ,è§‚å¯Ÿè¿ç®—è§„åˆ™
                            </p>
                        </div>
                    </div>
                `;
                actionButtons.innerHTML = `
                    <button id="clearBtn" class="apple-btn danger-btn">æ¸…ç©ºç»„åˆ</button>
                    <button id="generateBtn" class="apple-btn action-btn">ç”Ÿæˆå›¾æ¡ˆ</button>
                `;
                initTab1();
            } else if (tabId === 'tab2') {
                sidebarContent.innerHTML = `
                    <div class="control-group">
                        <label>æ•°å­—åŒ–æ ·æœ¬</label>
                        <select id="sampleSelect" class="apple-btn primary-btn" style="width: 100%;">
                            <option value="sample1">æ¸…ä»£äº‘é¾™çº¹ç»‡é”¦</option>
                            <option value="sample2">æ°‘å›½å‡¤å‡°ç‰¡ä¸¹é”¦</option>
                            <option value="sample3">ä¼ ç»Ÿå‡ ä½•çº¹æ ·é”¦</option>
                            <option value="sample4">æ¹˜ç»£é£æ ¼ç»‡é”¦</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>æ‰«æåˆ†è¾¨ç‡</label>
                        <input type="range" id="resolution" min="300" max="2400" step="300" value="1200">
                        <div class="info-panel">
                            <p id="resolutionValue" style="font-size: 0.9rem; color: var(--accent-red); font-weight: 700;">1200 DPI</p>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>æå–ç®—æ³•</label>
                        <div class="info-panel">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="colorExtraction" checked> é¢œè‰²åˆ†æ
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="textureExtraction" checked> çº¹ç†è¯†åˆ«
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="patternExtraction" checked> å›¾æ¡ˆæå–
                            </label>
                        </div>
                    </div>
                `;
                actionButtons.innerHTML = `
                    <button id="extractBtn" class="apple-btn action-btn">å¼€å§‹æå–</button>
                `;
                initTab2();
            } else if (tabId === 'tab3') {
                sidebarContent.innerHTML = `
                    <div class="control-group">
                        <label>é€‰æ‹©å­ä»£æ•°ç³»ç»Ÿ</label>
                        <div id="subsystemsList" style="max-height: 350px; overflow-y: auto;"></div>
                    </div>
                    <div class="control-group">
                        <label>è¿ç®—è§„åˆ™</label>
                        <div class="info-panel" id="rulesPanel" style="max-height: 150px; overflow-y: auto;">
                            <p style="font-size: 0.85rem; color: var(--text-secondary);">è¯·å…ˆé€‰æ‹©å­ä»£æ•°ç³»ç»Ÿ</p>
                        </div>
                    </div>
                `;
                actionButtons.innerHTML = `
                    <button id="clearDesignBtn" class="apple-btn danger-btn">æ¸…ç©ºç”»å¸ƒ</button>
                    <button id="generateDesignBtn" class="apple-btn action-btn">ç”Ÿæˆå›¾æ¡ˆ</button>
                `;
                initTab3();
            }
        }

        // ==================== Tab 1: å…ƒç´ ä»£æ•°ç³»ç»Ÿ ====================
        function initTab1() {
            const grid = document.getElementById('elementsGrid');
            grid.innerHTML = '';
            elements.forEach(el => {
                const card = document.createElement('div');
                card.className = 'element-card';
                card.draggable = true;
                card.innerHTML = `
                    <div class="element-icon">${el.icon}</div>
                    <div class="element-name">${el.name}</div>
                    <div class="element-type">${el.type}: ${el.id}</div>
                `;
                card.addEventListener('dragstart', (e) => {
                    draggedElement = el;
                    e.dataTransfer.effectAllowed = 'copy';
                });
                grid.appendChild(card);
            });

            const compositionArea = document.getElementById('compositionArea');
            compositionArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            });
            compositionArea.addEventListener('drop', (e) => {
                e.preventDefault();
                if (draggedElement) {
                    composedElements.push(draggedElement);
                    updateCompositionArea();
                    updateOperationDisplay();
                    draggedElement = null;
                }
            });

            document.getElementById('generateBtn').addEventListener('click', () => {
                if (composedElements.length === 0) {
                    alert('è¯·å…ˆæ·»åŠ è®¾è®¡å…ƒç´ ï¼');
                    return;
                }
                const resultDisplay = document.getElementById('resultDisplay');
                const resultPattern = document.getElementById('resultPattern');
                const resultDesc = document.getElementById('resultDesc');

                const types = [...new Set(composedElements.map(e => e.type))];
                const names = composedElements.map(e => e.name).join('ã€');
                resultDesc.textContent = `èåˆäº†${names}ç­‰å…ƒç´ ,è¿ç”¨äº†${types.join('ä¸')}çš„ç»„åˆ,å±•ç°æ¹–æ¹˜ç»‡é”¦çš„ç²¾æ¹›å·¥è‰º`;

                resultPattern.innerHTML = '';
                const colors = composedElements.map(e => e.color);
                const gridSize = 8;

                for (let i = 0; i < gridSize * gridSize; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'pattern-cell';
                    const colorIdx = (i * 3 + Math.floor(i / gridSize)) % colors.length;
                    const brightness = 0.7 + (Math.sin(i * 0.5) * 0.3);
                    cell.style.backgroundColor = colors[colorIdx];
                    cell.style.opacity = brightness;
                    resultPattern.appendChild(cell);
                }

                resultDisplay.style.display = 'block';
                resultDisplay.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });

            document.getElementById('clearBtn').addEventListener('click', () => {
                composedElements = [];
                updateCompositionArea();
                updateOperationDisplay();
                document.getElementById('resultDisplay').style.display = 'none';
            });
        }

        function updateCompositionArea() {
            const area = document.getElementById('compositionArea');
            if (composedElements.length === 0) {
                area.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ¨</div>
                        <p>æ‹–æ‹½å·¦ä¾§å…ƒç´ åˆ°æ­¤å¤„å¼€å§‹åˆ›ä½œ</p>
                        <p style="font-size: 0.85rem; margin-top: 8px;">ä½“éªŒä¼ ç»Ÿå·¥è‰ºçš„æ•°å­—åŒ–ä¼ æ‰¿</p>
                    </div>
                `;
                area.classList.remove('has-elements');
            } else {
                area.innerHTML = '';
                area.classList.add('has-elements');
                composedElements.forEach(el => {
                    const card = document.createElement('div');
                    card.className = 'element-card';
                    card.innerHTML = `
                        <div class="element-icon">${el.icon}</div>
                        <div class="element-name">${el.name}</div>
                    `;
                    card.style.borderColor = el.color;
                    area.appendChild(card);
                });
            }
        }

        function updateOperationDisplay() {
            const display = document.getElementById('operationDisplay');
            if (composedElements.length === 0) {
                display.innerHTML = '';
            } else if (composedElements.length === 1) {
                display.innerHTML = `å½“å‰å…ƒç´ : ${composedElements[0].id}`;
            } else {
                const expr = composedElements.map(e => e.id).join(' * ');
                display.innerHTML = `ç»„åˆè¡¨è¾¾å¼: ${expr}`;
            }
        }

        // ==================== Tab 2: ç‰¹å¾æå– ====================
        function initTab2() {
            updatePreview();

            document.getElementById('resolution').addEventListener('input', (e) => {
                document.getElementById('resolutionValue').textContent = `${e.target.value} DPI`;
            });

            document.getElementById('sampleSelect').addEventListener('change', (e) => {
                currentSample = samples[e.target.value];
                updatePreview();
            });

            document.getElementById('extractBtn').addEventListener('click', async () => {
                const container = document.getElementById('featuresContainer');
                container.style.display = 'block';
                document.querySelectorAll('.progress-fill').forEach(bar => {
                    bar.style.width = '0%';
                });
                await animateExtraction();
            });
        }

        function updatePreview() {
            const pattern = document.getElementById('brocadePattern');
            pattern.style.background = currentSample.gradient;
        }

        async function animateExtraction() {
            const colorEnabled = document.getElementById('colorExtraction').checked;
            const textureEnabled = document.getElementById('textureExtraction').checked;
            const patternEnabled = document.getElementById('patternExtraction').checked;

            if (colorEnabled) await extractColors();
            if (textureEnabled) await extractTextures();
            if (patternEnabled) await extractPatterns();
        }

        async function extractColors() {
            const palette = document.getElementById('colorPalette');
            palette.innerHTML = '';
            const progressBar = document.querySelector('#colorFeature .progress-fill');

            for (let i = 0; i < currentSample.colors.length; i++) {
                await sleep(300);
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = currentSample.colors[i];
                swatch.innerHTML = `<div class="color-label">${currentSample.colorNames[i]}</div>`;
                palette.appendChild(swatch);
                progressBar.style.width = `${((i + 1) / currentSample.colors.length) * 100}%`;
            }
        }

        async function extractTextures() {
            const preview = document.getElementById('texturePreview');
            preview.innerHTML = '';
            const progressBar = document.querySelector('#textureFeature .progress-fill');

            const texturePatterns = [
                'repeating-linear-gradient(45deg, #8b0000 0px, #8b0000 2px, #d63b1d 2px, #d63b1d 4px)',
                'repeating-linear-gradient(90deg, #d63b1d 0px, #d63b1d 3px, transparent 3px, transparent 6px)',
                'radial-gradient(circle, #8b0000 20%, transparent 20%), radial-gradient(circle, #8b0000 20%, transparent 20%)',
                'linear-gradient(45deg, #d63b1d 25%, transparent 25%, transparent 75%, #d63b1d 75%)'
            ];

            for (let i = 0; i < currentSample.textures.length; i++) {
                await sleep(400);
                const sample = document.createElement('div');
                sample.className = 'texture-sample';
                sample.style.background = texturePatterns[i % texturePatterns.length];
                sample.style.backgroundSize = '10px 10px';
                sample.title = currentSample.textures[i];
                preview.appendChild(sample);
                progressBar.style.width = `${((i + 1) / currentSample.textures.length) * 100}%`;
            }
        }

        async function extractPatterns() {
            const elements = document.getElementById('patternElements');
            elements.innerHTML = '';
            const progressBar = document.querySelector('#patternFeature .progress-fill');

            for (let i = 0; i < currentSample.patterns.length; i++) {
                await sleep(350);
                const tag = document.createElement('div');
                tag.className = 'element-tag';
                tag.textContent = currentSample.patterns[i];
                elements.appendChild(tag);
                progressBar.style.width = `${((i + 1) / currentSample.patterns.length) * 100}%`;
            }
        }

        // ==================== Tab 3: å­ä»£æ•°ç³»ç»Ÿè®¾è®¡ ====================
        function initTab3() {
            const list = document.getElementById('subsystemsList');
            list.innerHTML = '';
            subsystems.forEach(sys => {
                const card = document.createElement('div');
                card.className = 'subsystem-card';
                card.innerHTML = `
                    <div class="subsystem-title">
                        <span>${sys.icon}</span>
                        <span>${sys.name}</span>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px;">
                        é›†åˆ ${sys.id}: æ ¸å¿ƒå…ƒç´  ${sys.elements.length} ä¸ª
                    </div>
                    <div class="subsystem-elements">
                        ${sys.elements.map(el => `<span class="mini-element">${el}</span>`).join('')}
                    </div>
                `;
                card.addEventListener('click', () => selectSubsystem(sys, card));
                list.appendChild(card);
            });

            const canvas = document.getElementById('designCanvas');
            canvas.innerHTML = '';
            designCells = [];
            for (let i = 0; i < 64; i++) {
                const cell = document.createElement('div');
                cell.className = 'canvas-cell';
                canvas.appendChild(cell);
                designCells.push(cell);
            }

            document.getElementById('generateDesignBtn').addEventListener('click', () => {
                if (!selectedSubsystem) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå­ä»£æ•°ç³»ç»Ÿï¼');
                    return;
                }
                generatePattern();
            });

            document.getElementById('clearDesignBtn').addEventListener('click', () => {
                designCells.forEach(cell => {
                    cell.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
                    cell.classList.remove('filled');
                });
            });
        }

        function selectSubsystem(sys, card) {
            document.querySelectorAll('.subsystem-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            selectedSubsystem = sys;

            const rulesPanel = document.getElementById('rulesPanel');
            rulesPanel.innerHTML = sys.rules.map(rule => `
                <div class="operation-rule">
                    <div class="rule-title">${rule.title}</div>
                    <div class="rule-desc">${rule.desc}</div>
                </div>
            `).join('');
        }

        async function generatePattern() {
            const sys = selectedSubsystem;
            designCells.forEach(cell => {
                cell.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
                cell.classList.remove('filled');
            });

            const colors = sys.colors;
            const patterns = [
                (i) => i % 8 < 4 ? colors[0] : colors[1],
                (i) => colors[Math.floor((i / 64) * colors.length)],
                (i) => (Math.floor(i / 8) + i) % 2 === 0 ? colors[0] : colors[2],
                (i) => {
                    const row = Math.floor(i / 8);
                    const col = i % 8;
                    const dist = Math.abs(row - 3.5) + Math.abs(col - 3.5);
                    return colors[Math.floor(dist) % colors.length];
                }
            ];

            const pattern = patterns[Math.floor(Math.random() * patterns.length)];

            for (let i = 0; i < designCells.length; i++) {
                await sleep(30);
                designCells[i].style.backgroundColor = pattern(i);
                designCells[i].classList.add('filled');
            }
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ==================== åˆå§‹åŒ– ====================
        updateSidebar('tab1');
    </script>

<!-- å›ºå®šåº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
<footer style="
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(135deg, #D63B1D 0%, #B8321A 100%);
    color: white;
    padding: 15px 10px;
    text-align: center;
    box-shadow: 0 -4px 20px rgba(214, 59, 29, 0.25);
    z-index: 9999;
">
    <p style="font-size: 0.9rem; line-height: 1.6; margin: 0; opacity: 0.95;">
        Â© 2025 æ¹–å—ä¿¡æ¯å­¦é™¢ ï½œ è®¡ç®—æœºç§‘å­¦ä¸å·¥ç¨‹æ€æ”¿åº“å»ºè®¾å›¢é˜Ÿ<br>
        ç‰ˆæƒæ‰€æœ‰ ï½œ é¡¹ç›®æ€»è´Ÿè´£äººï¼šè°¢é‘«
    </p>
</footer>


</body>

</html>
